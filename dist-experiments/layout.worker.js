function jt(t,n,i){var e,r=1;t==null&&(t=0),n==null&&(n=0),i==null&&(i=0);function s(){var f,o=e.length,a,l=0,u=0,c=0;for(f=0;f<o;++f)a=e[f],l+=a.x||0,u+=a.y||0,c+=a.z||0;for(l=(l/o-t)*r,u=(u/o-n)*r,c=(c/o-i)*r,f=0;f<o;++f)a=e[f],l&&(a.x-=l),u&&(a.y-=u),c&&(a.z-=c)}return s.initialize=function(f){e=f},s.x=function(f){return arguments.length?(t=+f,s):t},s.y=function(f){return arguments.length?(n=+f,s):n},s.z=function(f){return arguments.length?(i=+f,s):i},s.strength=function(f){return arguments.length?(r=+f,s):r},s}function St(t){const n=+this._x.call(null,t);return At(this.cover(n),n,t)}function At(t,n,i){if(isNaN(n))return t;var e,r=t._root,s={data:i},f=t._x0,o=t._x1,a,l,u,c,v;if(!r)return t._root=s,t;for(;r.length;)if((u=n>=(a=(f+o)/2))?f=a:o=a,e=r,!(r=r[c=+u]))return e[c]=s,t;if(l=+t._x.call(null,r.data),n===l)return s.next=r,e?e[c]=s:t._root=s,t;do e=e?e[c]=new Array(2):t._root=new Array(2),(u=n>=(a=(f+o)/2))?f=a:o=a;while((c=+u)==(v=+(l>=a)));return e[v]=r,e[c]=s,t}function Lt(t){Array.isArray(t)||(t=Array.from(t));const n=t.length,i=new Float64Array(n);let e=1/0,r=-1/0;for(let s=0,f;s<n;++s)isNaN(f=+this._x.call(null,t[s]))||(i[s]=f,f<e&&(e=f),f>r&&(r=f));if(e>r)return this;this.cover(e).cover(r);for(let s=0;s<n;++s)At(this,i[s],t[s]);return this}function Pt(t){if(isNaN(t=+t))return this;var n=this._x0,i=this._x1;if(isNaN(n))i=(n=Math.floor(t))+1;else{for(var e=i-n||1,r=this._root,s,f;n>t||t>=i;)switch(f=+(t<n),s=new Array(2),s[f]=r,r=s,e*=2,f){case 0:i=n+e;break;case 1:n=i-e;break}this._root&&this._root.length&&(this._root=r)}return this._x0=n,this._x1=i,this}function Rt(){var t=[];return this.visit(function(n){if(!n.length)do t.push(n.data);while(n=n.next)}),t}function Yt(t){return arguments.length?this.cover(+t[0][0]).cover(+t[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function P(t,n,i){this.node=t,this.x0=n,this.x1=i}function Ct(t,n){var i,e=this._x0,r,s,f=this._x1,o=[],a=this._root,l,u;for(a&&o.push(new P(a,e,f)),n==null?n=1/0:(e=t-n,f=t+n);l=o.pop();)if(!(!(a=l.node)||(r=l.x0)>f||(s=l.x1)<e))if(a.length){var c=(r+s)/2;o.push(new P(a[1],c,s),new P(a[0],r,c)),(u=+(t>=c))&&(l=o[o.length-1],o[o.length-1]=o[o.length-1-u],o[o.length-1-u]=l)}else{var v=Math.abs(t-+this._x.call(null,a.data));v<n&&(n=v,e=t-v,f=t+v,i=a.data)}return i}function Ut(t){if(isNaN(a=+this._x.call(null,t)))return this;var n,i=this._root,e,r,s,f=this._x0,o=this._x1,a,l,u,c,v;if(!i)return this;if(i.length)for(;;){if((u=a>=(l=(f+o)/2))?f=l:o=l,n=i,!(i=i[c=+u]))return this;if(!i.length)break;n[c+1&1]&&(e=n,v=c)}for(;i.data!==t;)if(r=i,!(i=i.next))return this;return(s=i.next)&&delete i.next,r?(s?r.next=s:delete r.next,this):n?(s?n[c]=s:delete n[c],(i=n[0]||n[1])&&i===(n[1]||n[0])&&!i.length&&(e?e[v]=i:this._root=i),this):(this._root=s,this)}function Xt(t){for(var n=0,i=t.length;n<i;++n)this.remove(t[n]);return this}function Bt(){return this._root}function Ht(){var t=0;return this.visit(function(n){if(!n.length)do++t;while(n=n.next)}),t}function Qt(t){var n=[],i,e=this._root,r,s,f;for(e&&n.push(new P(e,this._x0,this._x1));i=n.pop();)if(!t(e=i.node,s=i.x0,f=i.x1)&&e.length){var o=(s+f)/2;(r=e[1])&&n.push(new P(r,o,f)),(r=e[0])&&n.push(new P(r,s,o))}return this}function Wt(t){var n=[],i=[],e;for(this._root&&n.push(new P(this._root,this._x0,this._x1));e=n.pop();){var r=e.node;if(r.length){var s,f=e.x0,o=e.x1,a=(f+o)/2;(s=r[0])&&n.push(new P(s,f,a)),(s=r[1])&&n.push(new P(s,a,o))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.x1);return this}function Zt(t){return t[0]}function Gt(t){return arguments.length?(this._x=t,this):this._x}function st(t,n){var i=new ot(n??Zt,NaN,NaN);return t==null?i:i.addAll(t)}function ot(t,n,i){this._x=t,this._x0=n,this._x1=i,this._root=void 0}function lt(t){for(var n={data:t.data},i=n;t=t.next;)i=i.next={data:t.data};return n}var O=st.prototype=ot.prototype;O.copy=function(){var t=new ot(this._x,this._x0,this._x1),n=this._root,i,e;if(!n)return t;if(!n.length)return t._root=lt(n),t;for(i=[{source:n,target:t._root=new Array(2)}];n=i.pop();)for(var r=0;r<2;++r)(e=n.source[r])&&(e.length?i.push({source:e,target:n.target[r]=new Array(2)}):n.target[r]=lt(e));return t};O.add=St;O.addAll=Lt;O.cover=Pt;O.data=Rt;O.extent=Yt;O.find=Ct;O.remove=Ut;O.removeAll=Xt;O.root=Bt;O.size=Ht;O.visit=Qt;O.visitAfter=Wt;O.x=Gt;function Jt(t){const n=+this._x.call(null,t),i=+this._y.call(null,t);return Mt(this.cover(n,i),n,i,t)}function Mt(t,n,i,e){if(isNaN(n)||isNaN(i))return t;var r,s=t._root,f={data:e},o=t._x0,a=t._y0,l=t._x1,u=t._y1,c,v,g,_,z,x,h,d;if(!s)return t._root=f,t;for(;s.length;)if((z=n>=(c=(o+l)/2))?o=c:l=c,(x=i>=(v=(a+u)/2))?a=v:u=v,r=s,!(s=s[h=x<<1|z]))return r[h]=f,t;if(g=+t._x.call(null,s.data),_=+t._y.call(null,s.data),n===g&&i===_)return f.next=s,r?r[h]=f:t._root=f,t;do r=r?r[h]=new Array(4):t._root=new Array(4),(z=n>=(c=(o+l)/2))?o=c:l=c,(x=i>=(v=(a+u)/2))?a=v:u=v;while((h=x<<1|z)===(d=(_>=v)<<1|g>=c));return r[d]=s,r[h]=f,t}function Kt(t){var n,i,e=t.length,r,s,f=new Array(e),o=new Array(e),a=1/0,l=1/0,u=-1/0,c=-1/0;for(i=0;i<e;++i)isNaN(r=+this._x.call(null,n=t[i]))||isNaN(s=+this._y.call(null,n))||(f[i]=r,o[i]=s,r<a&&(a=r),r>u&&(u=r),s<l&&(l=s),s>c&&(c=s));if(a>u||l>c)return this;for(this.cover(a,l).cover(u,c),i=0;i<e;++i)Mt(this,f[i],o[i],t[i]);return this}function Vt(t,n){if(isNaN(t=+t)||isNaN(n=+n))return this;var i=this._x0,e=this._y0,r=this._x1,s=this._y1;if(isNaN(i))r=(i=Math.floor(t))+1,s=(e=Math.floor(n))+1;else{for(var f=r-i||1,o=this._root,a,l;i>t||t>=r||e>n||n>=s;)switch(l=(n<e)<<1|t<i,a=new Array(4),a[l]=o,o=a,f*=2,l){case 0:r=i+f,s=e+f;break;case 1:i=r-f,s=e+f;break;case 2:r=i+f,e=s-f;break;case 3:i=r-f,e=s-f;break}this._root&&this._root.length&&(this._root=o)}return this._x0=i,this._y0=e,this._x1=r,this._y1=s,this}function tn(){var t=[];return this.visit(function(n){if(!n.length)do t.push(n.data);while(n=n.next)}),t}function nn(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function F(t,n,i,e,r){this.node=t,this.x0=n,this.y0=i,this.x1=e,this.y1=r}function en(t,n,i){var e,r=this._x0,s=this._y0,f,o,a,l,u=this._x1,c=this._y1,v=[],g=this._root,_,z;for(g&&v.push(new F(g,r,s,u,c)),i==null?i=1/0:(r=t-i,s=n-i,u=t+i,c=n+i,i*=i);_=v.pop();)if(!(!(g=_.node)||(f=_.x0)>u||(o=_.y0)>c||(a=_.x1)<r||(l=_.y1)<s))if(g.length){var x=(f+a)/2,h=(o+l)/2;v.push(new F(g[3],x,h,a,l),new F(g[2],f,h,x,l),new F(g[1],x,o,a,h),new F(g[0],f,o,x,h)),(z=(n>=h)<<1|t>=x)&&(_=v[v.length-1],v[v.length-1]=v[v.length-1-z],v[v.length-1-z]=_)}else{var d=t-+this._x.call(null,g.data),p=n-+this._y.call(null,g.data),w=d*d+p*p;if(w<i){var y=Math.sqrt(i=w);r=t-y,s=n-y,u=t+y,c=n+y,e=g.data}}return e}function rn(t){if(isNaN(u=+this._x.call(null,t))||isNaN(c=+this._y.call(null,t)))return this;var n,i=this._root,e,r,s,f=this._x0,o=this._y0,a=this._x1,l=this._y1,u,c,v,g,_,z,x,h;if(!i)return this;if(i.length)for(;;){if((_=u>=(v=(f+a)/2))?f=v:a=v,(z=c>=(g=(o+l)/2))?o=g:l=g,n=i,!(i=i[x=z<<1|_]))return this;if(!i.length)break;(n[x+1&3]||n[x+2&3]||n[x+3&3])&&(e=n,h=x)}for(;i.data!==t;)if(r=i,!(i=i.next))return this;return(s=i.next)&&delete i.next,r?(s?r.next=s:delete r.next,this):n?(s?n[x]=s:delete n[x],(i=n[0]||n[1]||n[2]||n[3])&&i===(n[3]||n[2]||n[1]||n[0])&&!i.length&&(e?e[h]=i:this._root=i),this):(this._root=s,this)}function sn(t){for(var n=0,i=t.length;n<i;++n)this.remove(t[n]);return this}function on(){return this._root}function fn(){var t=0;return this.visit(function(n){if(!n.length)do++t;while(n=n.next)}),t}function an(t){var n=[],i,e=this._root,r,s,f,o,a;for(e&&n.push(new F(e,this._x0,this._y0,this._x1,this._y1));i=n.pop();)if(!t(e=i.node,s=i.x0,f=i.y0,o=i.x1,a=i.y1)&&e.length){var l=(s+o)/2,u=(f+a)/2;(r=e[3])&&n.push(new F(r,l,u,o,a)),(r=e[2])&&n.push(new F(r,s,u,l,a)),(r=e[1])&&n.push(new F(r,l,f,o,u)),(r=e[0])&&n.push(new F(r,s,f,l,u))}return this}function hn(t){var n=[],i=[],e;for(this._root&&n.push(new F(this._root,this._x0,this._y0,this._x1,this._y1));e=n.pop();){var r=e.node;if(r.length){var s,f=e.x0,o=e.y0,a=e.x1,l=e.y1,u=(f+a)/2,c=(o+l)/2;(s=r[0])&&n.push(new F(s,f,o,u,c)),(s=r[1])&&n.push(new F(s,u,o,a,c)),(s=r[2])&&n.push(new F(s,f,c,u,l)),(s=r[3])&&n.push(new F(s,u,c,a,l))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.x1,e.y1);return this}function un(t){return t[0]}function ln(t){return arguments.length?(this._x=t,this):this._x}function cn(t){return t[1]}function _n(t){return arguments.length?(this._y=t,this):this._y}function ft(t,n,i){var e=new at(n??un,i??cn,NaN,NaN,NaN,NaN);return t==null?e:e.addAll(t)}function at(t,n,i,e,r,s){this._x=t,this._y=n,this._x0=i,this._y0=e,this._x1=r,this._y1=s,this._root=void 0}function ct(t){for(var n={data:t.data},i=n;t=t.next;)i=i.next={data:t.data};return n}var D=ft.prototype=at.prototype;D.copy=function(){var t=new at(this._x,this._y,this._x0,this._y0,this._x1,this._y1),n=this._root,i,e;if(!n)return t;if(!n.length)return t._root=ct(n),t;for(i=[{source:n,target:t._root=new Array(4)}];n=i.pop();)for(var r=0;r<4;++r)(e=n.source[r])&&(e.length?i.push({source:e,target:n.target[r]=new Array(4)}):n.target[r]=ct(e));return t};D.add=Jt;D.addAll=Kt;D.cover=Vt;D.data=tn;D.extent=nn;D.find=en;D.remove=rn;D.removeAll=sn;D.root=on;D.size=fn;D.visit=an;D.visitAfter=hn;D.x=ln;D.y=_n;function vn(t){const n=+this._x.call(null,t),i=+this._y.call(null,t),e=+this._z.call(null,t);return mt(this.cover(n,i,e),n,i,e,t)}function mt(t,n,i,e,r){if(isNaN(n)||isNaN(i)||isNaN(e))return t;var s,f=t._root,o={data:r},a=t._x0,l=t._y0,u=t._z0,c=t._x1,v=t._y1,g=t._z1,_,z,x,h,d,p,w,y,N,A,M;if(!f)return t._root=o,t;for(;f.length;)if((w=n>=(_=(a+c)/2))?a=_:c=_,(y=i>=(z=(l+v)/2))?l=z:v=z,(N=e>=(x=(u+g)/2))?u=x:g=x,s=f,!(f=f[A=N<<2|y<<1|w]))return s[A]=o,t;if(h=+t._x.call(null,f.data),d=+t._y.call(null,f.data),p=+t._z.call(null,f.data),n===h&&i===d&&e===p)return o.next=f,s?s[A]=o:t._root=o,t;do s=s?s[A]=new Array(8):t._root=new Array(8),(w=n>=(_=(a+c)/2))?a=_:c=_,(y=i>=(z=(l+v)/2))?l=z:v=z,(N=e>=(x=(u+g)/2))?u=x:g=x;while((A=N<<2|y<<1|w)===(M=(p>=x)<<2|(d>=z)<<1|h>=_));return s[M]=f,s[A]=o,t}function gn(t){Array.isArray(t)||(t=Array.from(t));const n=t.length,i=new Float64Array(n),e=new Float64Array(n),r=new Float64Array(n);let s=1/0,f=1/0,o=1/0,a=-1/0,l=-1/0,u=-1/0;for(let c=0,v,g,_,z;c<n;++c)isNaN(g=+this._x.call(null,v=t[c]))||isNaN(_=+this._y.call(null,v))||isNaN(z=+this._z.call(null,v))||(i[c]=g,e[c]=_,r[c]=z,g<s&&(s=g),g>a&&(a=g),_<f&&(f=_),_>l&&(l=_),z<o&&(o=z),z>u&&(u=z));if(s>a||f>l||o>u)return this;this.cover(s,f,o).cover(a,l,u);for(let c=0;c<n;++c)mt(this,i[c],e[c],r[c],t[c]);return this}function yn(t,n,i){if(isNaN(t=+t)||isNaN(n=+n)||isNaN(i=+i))return this;var e=this._x0,r=this._y0,s=this._z0,f=this._x1,o=this._y1,a=this._z1;if(isNaN(e))f=(e=Math.floor(t))+1,o=(r=Math.floor(n))+1,a=(s=Math.floor(i))+1;else{for(var l=f-e||1,u=this._root,c,v;e>t||t>=f||r>n||n>=o||s>i||i>=a;)switch(v=(i<s)<<2|(n<r)<<1|t<e,c=new Array(8),c[v]=u,u=c,l*=2,v){case 0:f=e+l,o=r+l,a=s+l;break;case 1:e=f-l,o=r+l,a=s+l;break;case 2:f=e+l,r=o-l,a=s+l;break;case 3:e=f-l,r=o-l,a=s+l;break;case 4:f=e+l,o=r+l,s=a-l;break;case 5:e=f-l,o=r+l,s=a-l;break;case 6:f=e+l,r=o-l,s=a-l;break;case 7:e=f-l,r=o-l,s=a-l;break}this._root&&this._root.length&&(this._root=u)}return this._x0=e,this._y0=r,this._z0=s,this._x1=f,this._y1=o,this._z1=a,this}function xn(){var t=[];return this.visit(function(n){if(!n.length)do t.push(n.data);while(n=n.next)}),t}function pn(t){return arguments.length?this.cover(+t[0][0],+t[0][1],+t[0][2]).cover(+t[1][0],+t[1][1],+t[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function $(t,n,i,e,r,s,f){this.node=t,this.x0=n,this.y0=i,this.z0=e,this.x1=r,this.y1=s,this.z1=f}function wn(t,n,i,e){var r,s=this._x0,f=this._y0,o=this._z0,a,l,u,c,v,g,_=this._x1,z=this._y1,x=this._z1,h=[],d=this._root,p,w;for(d&&h.push(new $(d,s,f,o,_,z,x)),e==null?e=1/0:(s=t-e,f=n-e,o=i-e,_=t+e,z=n+e,x=i+e,e*=e);p=h.pop();)if(!(!(d=p.node)||(a=p.x0)>_||(l=p.y0)>z||(u=p.z0)>x||(c=p.x1)<s||(v=p.y1)<f||(g=p.z1)<o))if(d.length){var y=(a+c)/2,N=(l+v)/2,A=(u+g)/2;h.push(new $(d[7],y,N,A,c,v,g),new $(d[6],a,N,A,y,v,g),new $(d[5],y,l,A,c,N,g),new $(d[4],a,l,A,y,N,g),new $(d[3],y,N,u,c,v,A),new $(d[2],a,N,u,y,v,A),new $(d[1],y,l,u,c,N,A),new $(d[0],a,l,u,y,N,A)),(w=(i>=A)<<2|(n>=N)<<1|t>=y)&&(p=h[h.length-1],h[h.length-1]=h[h.length-1-w],h[h.length-1-w]=p)}else{var M=t-+this._x.call(null,d.data),k=n-+this._y.call(null,d.data),T=i-+this._z.call(null,d.data),b=M*M+k*k+T*T;if(b<e){var m=Math.sqrt(e=b);s=t-m,f=n-m,o=i-m,_=t+m,z=n+m,x=i+m,r=d.data}}return r}const dn=(t,n,i,e,r,s)=>Math.sqrt((t-e)**2+(n-r)**2+(i-s)**2);function zn(t,n,i,e){const r=[],s=t-e,f=n-e,o=i-e,a=t+e,l=n+e,u=i+e;return this.visit((c,v,g,_,z,x,h)=>{if(!c.length)do{const d=c.data;dn(t,n,i,this._x(d),this._y(d),this._z(d))<=e&&r.push(d)}while(c=c.next);return v>a||g>l||_>u||z<s||x<f||h<o}),r}function Nn(t){if(isNaN(v=+this._x.call(null,t))||isNaN(g=+this._y.call(null,t))||isNaN(_=+this._z.call(null,t)))return this;var n,i=this._root,e,r,s,f=this._x0,o=this._y0,a=this._z0,l=this._x1,u=this._y1,c=this._z1,v,g,_,z,x,h,d,p,w,y,N;if(!i)return this;if(i.length)for(;;){if((d=v>=(z=(f+l)/2))?f=z:l=z,(p=g>=(x=(o+u)/2))?o=x:u=x,(w=_>=(h=(a+c)/2))?a=h:c=h,n=i,!(i=i[y=w<<2|p<<1|d]))return this;if(!i.length)break;(n[y+1&7]||n[y+2&7]||n[y+3&7]||n[y+4&7]||n[y+5&7]||n[y+6&7]||n[y+7&7])&&(e=n,N=y)}for(;i.data!==t;)if(r=i,!(i=i.next))return this;return(s=i.next)&&delete i.next,r?(s?r.next=s:delete r.next,this):n?(s?n[y]=s:delete n[y],(i=n[0]||n[1]||n[2]||n[3]||n[4]||n[5]||n[6]||n[7])&&i===(n[7]||n[6]||n[5]||n[4]||n[3]||n[2]||n[1]||n[0])&&!i.length&&(e?e[N]=i:this._root=i),this):(this._root=s,this)}function An(t){for(var n=0,i=t.length;n<i;++n)this.remove(t[n]);return this}function Mn(){return this._root}function mn(){var t=0;return this.visit(function(n){if(!n.length)do++t;while(n=n.next)}),t}function $n(t){var n=[],i,e=this._root,r,s,f,o,a,l,u;for(e&&n.push(new $(e,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));i=n.pop();)if(!t(e=i.node,s=i.x0,f=i.y0,o=i.z0,a=i.x1,l=i.y1,u=i.z1)&&e.length){var c=(s+a)/2,v=(f+l)/2,g=(o+u)/2;(r=e[7])&&n.push(new $(r,c,v,g,a,l,u)),(r=e[6])&&n.push(new $(r,s,v,g,c,l,u)),(r=e[5])&&n.push(new $(r,c,f,g,a,v,u)),(r=e[4])&&n.push(new $(r,s,f,g,c,v,u)),(r=e[3])&&n.push(new $(r,c,v,o,a,l,g)),(r=e[2])&&n.push(new $(r,s,v,o,c,l,g)),(r=e[1])&&n.push(new $(r,c,f,o,a,v,g)),(r=e[0])&&n.push(new $(r,s,f,o,c,v,g))}return this}function qn(t){var n=[],i=[],e;for(this._root&&n.push(new $(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));e=n.pop();){var r=e.node;if(r.length){var s,f=e.x0,o=e.y0,a=e.z0,l=e.x1,u=e.y1,c=e.z1,v=(f+l)/2,g=(o+u)/2,_=(a+c)/2;(s=r[0])&&n.push(new $(s,f,o,a,v,g,_)),(s=r[1])&&n.push(new $(s,v,o,a,l,g,_)),(s=r[2])&&n.push(new $(s,f,g,a,v,u,_)),(s=r[3])&&n.push(new $(s,v,g,a,l,u,_)),(s=r[4])&&n.push(new $(s,f,o,_,v,g,c)),(s=r[5])&&n.push(new $(s,v,o,_,l,g,c)),(s=r[6])&&n.push(new $(s,f,g,_,v,u,c)),(s=r[7])&&n.push(new $(s,v,g,_,l,u,c))}i.push(e)}for(;e=i.pop();)t(e.node,e.x0,e.y0,e.z0,e.x1,e.y1,e.z1);return this}function In(t){return t[0]}function bn(t){return arguments.length?(this._x=t,this):this._x}function En(t){return t[1]}function kn(t){return arguments.length?(this._y=t,this):this._y}function Tn(t){return t[2]}function Fn(t){return arguments.length?(this._z=t,this):this._z}function ht(t,n,i,e){var r=new ut(n??In,i??En,e??Tn,NaN,NaN,NaN,NaN,NaN,NaN);return t==null?r:r.addAll(t)}function ut(t,n,i,e,r,s,f,o,a){this._x=t,this._y=n,this._z=i,this._x0=e,this._y0=r,this._z0=s,this._x1=f,this._y1=o,this._z1=a,this._root=void 0}function _t(t){for(var n={data:t.data},i=n;t=t.next;)i=i.next={data:t.data};return n}var I=ht.prototype=ut.prototype;I.copy=function(){var t=new ut(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),n=this._root,i,e;if(!n)return t;if(!n.length)return t._root=_t(n),t;for(i=[{source:n,target:t._root=new Array(8)}];n=i.pop();)for(var r=0;r<8;++r)(e=n.source[r])&&(e.length?i.push({source:e,target:n.target[r]=new Array(8)}):n.target[r]=_t(e));return t};I.add=vn;I.addAll=gn;I.cover=yn;I.data=xn;I.extent=pn;I.find=wn;I.findAllWithinRadius=zn;I.remove=Nn;I.removeAll=An;I.root=Mn;I.size=mn;I.visit=$n;I.visitAfter=qn;I.x=bn;I.y=kn;I.z=Fn;function q(t){return function(){return t}}function j(t){return(t()-.5)*1e-6}function nt(t){return t.x+t.vx}function vt(t){return t.y+t.vy}function Dn(t){return t.z+t.vz}function On(t){var n,i,e,r,s=1,f=1;typeof t!="function"&&(t=q(t==null?1:+t));function o(){for(var u,c=n.length,v,g,_,z,x,h,d,p=0;p<f;++p)for(v=(i===1?st(n,nt):i===2?ft(n,nt,vt):i===3?ht(n,nt,vt,Dn):null).visitAfter(a),u=0;u<c;++u)g=n[u],h=e[g.index],d=h*h,_=g.x+g.vx,i>1&&(z=g.y+g.vy),i>2&&(x=g.z+g.vz),v.visit(w);function w(y,N,A,M,k,T,b){var m=[N,A,M,k,T,b],Z=m[0],kt=m[1],Tt=m[2],Ft=m[i],Dt=m[i+1],Ot=m[i+2],S=y.data,G=y.r,E=h+G;if(S){if(S.index>g.index){var R=_-S.x-S.vx,Y=i>1?z-S.y-S.vy:0,C=i>2?x-S.z-S.vz:0,L=R*R+Y*Y+C*C;L<E*E&&(R===0&&(R=j(r),L+=R*R),i>1&&Y===0&&(Y=j(r),L+=Y*Y),i>2&&C===0&&(C=j(r),L+=C*C),L=(E-(L=Math.sqrt(L)))/L*s,g.vx+=(R*=L)*(E=(G*=G)/(d+G)),i>1&&(g.vy+=(Y*=L)*E),i>2&&(g.vz+=(C*=L)*E),S.vx-=R*(E=1-E),i>1&&(S.vy-=Y*E),i>2&&(S.vz-=C*E))}return}return Z>_+E||Ft<_-E||i>1&&(kt>z+E||Dt<z-E)||i>2&&(Tt>x+E||Ot<x-E)}}function a(u){if(u.data)return u.r=e[u.data.index];for(var c=u.r=0;c<Math.pow(2,i);++c)u[c]&&u[c].r>u.r&&(u.r=u[c].r)}function l(){if(n){var u,c=n.length,v;for(e=new Array(c),u=0;u<c;++u)v=n[u],e[v.index]=+t(v,u,n)}}return o.initialize=function(u,...c){n=u,r=c.find(v=>typeof v=="function")||Math.random,i=c.find(v=>[1,2,3].includes(v))||2,l()},o.iterations=function(u){return arguments.length?(f=+u,o):f},o.strength=function(u){return arguments.length?(s=+u,o):s},o.radius=function(u){return arguments.length?(t=typeof u=="function"?u:q(+u),l(),o):t},o}function jn(t){return t.index}function gt(t,n){var i=t.get(n);if(!i)throw new Error("node not found: "+n);return i}function Sn(t){var n=jn,i=v,e,r=q(30),s,f,o,a,l,u,c=1;t==null&&(t=[]);function v(h){return 1/Math.min(a[h.source.index],a[h.target.index])}function g(h){for(var d=0,p=t.length;d<c;++d)for(var w=0,y,N,A,M=0,k=0,T=0,b,m;w<p;++w)y=t[w],N=y.source,A=y.target,M=A.x+A.vx-N.x-N.vx||j(u),o>1&&(k=A.y+A.vy-N.y-N.vy||j(u)),o>2&&(T=A.z+A.vz-N.z-N.vz||j(u)),b=Math.sqrt(M*M+k*k+T*T),b=(b-s[w])/b*h*e[w],M*=b,k*=b,T*=b,A.vx-=M*(m=l[w]),o>1&&(A.vy-=k*m),o>2&&(A.vz-=T*m),N.vx+=M*(m=1-m),o>1&&(N.vy+=k*m),o>2&&(N.vz+=T*m)}function _(){if(f){var h,d=f.length,p=t.length,w=new Map(f.map((N,A)=>[n(N,A,f),N])),y;for(h=0,a=new Array(d);h<p;++h)y=t[h],y.index=h,typeof y.source!="object"&&(y.source=gt(w,y.source)),typeof y.target!="object"&&(y.target=gt(w,y.target)),a[y.source.index]=(a[y.source.index]||0)+1,a[y.target.index]=(a[y.target.index]||0)+1;for(h=0,l=new Array(p);h<p;++h)y=t[h],l[h]=a[y.source.index]/(a[y.source.index]+a[y.target.index]);e=new Array(p),z(),s=new Array(p),x()}}function z(){if(f)for(var h=0,d=t.length;h<d;++h)e[h]=+i(t[h],h,t)}function x(){if(f)for(var h=0,d=t.length;h<d;++h)s[h]=+r(t[h],h,t)}return g.initialize=function(h,...d){f=h,u=d.find(p=>typeof p=="function")||Math.random,o=d.find(p=>[1,2,3].includes(p))||2,_()},g.links=function(h){return arguments.length?(t=h,_(),g):t},g.id=function(h){return arguments.length?(n=h,g):n},g.iterations=function(h){return arguments.length?(c=+h,g):c},g.strength=function(h){return arguments.length?(i=typeof h=="function"?h:q(+h),z(),g):i},g.distance=function(h){return arguments.length?(r=typeof h=="function"?h:q(+h),x(),g):r},g}var Ln={value:()=>{}};function $t(){for(var t=0,n=arguments.length,i={},e;t<n;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw new Error("illegal type: "+e);i[e]=[]}return new J(i)}function J(t){this._=t}function Pn(t,n){return t.trim().split(/^|\s+/).map(function(i){var e="",r=i.indexOf(".");if(r>=0&&(e=i.slice(r+1),i=i.slice(0,r)),i&&!n.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:e}})}J.prototype=$t.prototype={constructor:J,on:function(t,n){var i=this._,e=Pn(t+"",i),r,s=-1,f=e.length;if(arguments.length<2){for(;++s<f;)if((r=(t=e[s]).type)&&(r=Rn(i[r],t.name)))return r;return}if(n!=null&&typeof n!="function")throw new Error("invalid callback: "+n);for(;++s<f;)if(r=(t=e[s]).type)i[r]=yt(i[r],t.name,n);else if(n==null)for(r in i)i[r]=yt(i[r],t.name,null);return this},copy:function(){var t={},n=this._;for(var i in n)t[i]=n[i].slice();return new J(t)},call:function(t,n){if((r=arguments.length-2)>0)for(var i=new Array(r),e=0,r,s;e<r;++e)i[e]=arguments[e+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],e=0,r=s.length;e<r;++e)s[e].value.apply(n,i)},apply:function(t,n,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var e=this._[t],r=0,s=e.length;r<s;++r)e[r].value.apply(n,i)}};function Rn(t,n){for(var i=0,e=t.length,r;i<e;++i)if((r=t[i]).name===n)return r.value}function yt(t,n,i){for(var e=0,r=t.length;e<r;++e)if(t[e].name===n){t[e]=Ln,t=t.slice(0,e).concat(t.slice(e+1));break}return i!=null&&t.push({name:n,value:i}),t}var X=0,H=0,B=0,qt=1e3,K,Q,V=0,U=0,tt=0,W=typeof performance=="object"&&performance.now?performance:Date,It=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function bt(){return U||(It(Yn),U=W.now()+tt)}function Yn(){U=0}function et(){this._call=this._time=this._next=null}et.prototype=Et.prototype={constructor:et,restart:function(t,n,i){if(typeof t!="function")throw new TypeError("callback is not a function");i=(i==null?bt():+i)+(n==null?0:+n),!this._next&&Q!==this&&(Q?Q._next=this:K=this,Q=this),this._call=t,this._time=i,rt()},stop:function(){this._call&&(this._call=null,this._time=1/0,rt())}};function Et(t,n,i){var e=new et;return e.restart(t,n,i),e}function Cn(){bt(),++X;for(var t=K,n;t;)(n=U-t._time)>=0&&t._call.call(void 0,n),t=t._next;--X}function xt(){U=(V=W.now())+tt,X=H=0;try{Cn()}finally{X=0,Xn(),U=0}}function Un(){var t=W.now(),n=t-V;n>qt&&(tt-=n,V=t)}function Xn(){for(var t,n=K,i,e=1/0;n;)n._call?(e>n._time&&(e=n._time),t=n,n=n._next):(i=n._next,n._next=null,n=t?t._next=i:K=i);Q=t,rt(e)}function rt(t){if(!X){H&&(H=clearTimeout(H));var n=t-U;n>24?(t<1/0&&(H=setTimeout(xt,t-W.now()-tt)),B&&(B=clearInterval(B))):(B||(V=W.now(),B=setInterval(Un,qt)),X=1,It(xt))}}const Bn=1664525,Hn=1013904223,pt=4294967296;function Qn(){let t=1;return()=>(t=(Bn*t+Hn)%pt)/pt}var wt=3;function it(t){return t.x}function dt(t){return t.y}function Wn(t){return t.z}var Zn=10,Gn=Math.PI*(3-Math.sqrt(5)),Jn=Math.PI*20/(9+Math.sqrt(221));function Kn(t,n){n=n||2;var i=Math.min(wt,Math.max(1,Math.round(n))),e,r=1,s=.001,f=1-Math.pow(s,1/300),o=0,a=.6,l=new Map,u=Et(g),c=$t("tick","end"),v=Qn();t==null&&(t=[]);function g(){_(),c.call("tick",e),r<s&&(u.stop(),c.call("end",e))}function _(h){var d,p=t.length,w;h===void 0&&(h=1);for(var y=0;y<h;++y)for(r+=(o-r)*f,l.forEach(function(N){N(r)}),d=0;d<p;++d)w=t[d],w.fx==null?w.x+=w.vx*=a:(w.x=w.fx,w.vx=0),i>1&&(w.fy==null?w.y+=w.vy*=a:(w.y=w.fy,w.vy=0)),i>2&&(w.fz==null?w.z+=w.vz*=a:(w.z=w.fz,w.vz=0));return e}function z(){for(var h=0,d=t.length,p;h<d;++h){if(p=t[h],p.index=h,p.fx!=null&&(p.x=p.fx),p.fy!=null&&(p.y=p.fy),p.fz!=null&&(p.z=p.fz),isNaN(p.x)||i>1&&isNaN(p.y)||i>2&&isNaN(p.z)){var w=Zn*(i>2?Math.cbrt(.5+h):i>1?Math.sqrt(.5+h):h),y=h*Gn,N=h*Jn;i===1?p.x=w:i===2?(p.x=w*Math.cos(y),p.y=w*Math.sin(y)):(p.x=w*Math.sin(y)*Math.cos(N),p.y=w*Math.cos(y),p.z=w*Math.sin(y)*Math.sin(N))}(isNaN(p.vx)||i>1&&isNaN(p.vy)||i>2&&isNaN(p.vz))&&(p.vx=0,i>1&&(p.vy=0),i>2&&(p.vz=0))}}function x(h){return h.initialize&&h.initialize(t,v,i),h}return z(),e={tick:_,restart:function(){return u.restart(g),e},stop:function(){return u.stop(),e},numDimensions:function(h){return arguments.length?(i=Math.min(wt,Math.max(1,Math.round(h))),l.forEach(x),e):i},nodes:function(h){return arguments.length?(t=h,z(),l.forEach(x),e):t},alpha:function(h){return arguments.length?(r=+h,e):r},alphaMin:function(h){return arguments.length?(s=+h,e):s},alphaDecay:function(h){return arguments.length?(f=+h,e):+f},alphaTarget:function(h){return arguments.length?(o=+h,e):o},velocityDecay:function(h){return arguments.length?(a=1-h,e):1-a},randomSource:function(h){return arguments.length?(v=h,l.forEach(x),e):v},force:function(h,d){return arguments.length>1?(d==null?l.delete(h):l.set(h,x(d)),e):l.get(h)},find:function(){var h=Array.prototype.slice.call(arguments),d=h.shift()||0,p=(i>1?h.shift():null)||0,w=(i>2?h.shift():null)||0,y=h.shift()||1/0,N=0,A=t.length,M,k,T,b,m,Z;for(y*=y,N=0;N<A;++N)m=t[N],M=d-m.x,k=p-(m.y||0),T=w-(m.z||0),b=M*M+k*k+T*T,b<y&&(Z=m,y=b);return Z},on:function(h,d){return arguments.length>1?(c.on(h,d),e):c.on(h)}}}function Vn(){var t,n,i,e,r,s=q(-30),f,o=1,a=1/0,l=.81;function u(_){var z,x=t.length,h=(n===1?st(t,it):n===2?ft(t,it,dt):n===3?ht(t,it,dt,Wn):null).visitAfter(v);for(r=_,z=0;z<x;++z)i=t[z],h.visit(g)}function c(){if(t){var _,z=t.length,x;for(f=new Array(z),_=0;_<z;++_)x=t[_],f[x.index]=+s(x,_,t)}}function v(_){var z=0,x,h,d=0,p,w,y,N,A=_.length;if(A){for(p=w=y=N=0;N<A;++N)(x=_[N])&&(h=Math.abs(x.value))&&(z+=x.value,d+=h,p+=h*(x.x||0),w+=h*(x.y||0),y+=h*(x.z||0));z*=Math.sqrt(4/A),_.x=p/d,n>1&&(_.y=w/d),n>2&&(_.z=y/d)}else{x=_,x.x=x.data.x,n>1&&(x.y=x.data.y),n>2&&(x.z=x.data.z);do z+=f[x.data.index];while(x=x.next)}_.value=z}function g(_,z,x,h,d){if(!_.value)return!0;var p=[x,h,d][n-1],w=_.x-i.x,y=n>1?_.y-i.y:0,N=n>2?_.z-i.z:0,A=p-z,M=w*w+y*y+N*N;if(A*A/l<M)return M<a&&(w===0&&(w=j(e),M+=w*w),n>1&&y===0&&(y=j(e),M+=y*y),n>2&&N===0&&(N=j(e),M+=N*N),M<o&&(M=Math.sqrt(o*M)),i.vx+=w*_.value*r/M,n>1&&(i.vy+=y*_.value*r/M),n>2&&(i.vz+=N*_.value*r/M)),!0;if(_.length||M>=a)return;(_.data!==i||_.next)&&(w===0&&(w=j(e),M+=w*w),n>1&&y===0&&(y=j(e),M+=y*y),n>2&&N===0&&(N=j(e),M+=N*N),M<o&&(M=Math.sqrt(o*M)));do _.data!==i&&(A=f[_.data.index]*r/M,i.vx+=w*A,n>1&&(i.vy+=y*A),n>2&&(i.vz+=N*A));while(_=_.next)}return u.initialize=function(_,...z){t=_,e=z.find(x=>typeof x=="function")||Math.random,n=z.find(x=>[1,2,3].includes(x))||2,c()},u.strength=function(_){return arguments.length?(s=typeof _=="function"?_:q(+_),c(),u):s},u.distanceMin=function(_){return arguments.length?(o=_*_,u):Math.sqrt(o)},u.distanceMax=function(_){return arguments.length?(a=_*_,u):Math.sqrt(a)},u.theta=function(_){return arguments.length?(l=_*_,u):Math.sqrt(l)},u}function zt(t){var n=q(.1),i,e,r;typeof t!="function"&&(t=q(t==null?0:+t));function s(o){for(var a=0,l=i.length,u;a<l;++a)u=i[a],u.vx+=(r[a]-u.x)*e[a]*o}function f(){if(i){var o,a=i.length;for(e=new Array(a),r=new Array(a),o=0;o<a;++o)e[o]=isNaN(r[o]=+t(i[o],o,i))?0:+n(i[o],o,i)}}return s.initialize=function(o){i=o,f()},s.strength=function(o){return arguments.length?(n=typeof o=="function"?o:q(+o),f(),s):n},s.x=function(o){return arguments.length?(t=typeof o=="function"?o:q(+o),f(),s):t},s}function Nt(t){var n=q(.1),i,e,r;typeof t!="function"&&(t=q(t==null?0:+t));function s(o){for(var a=0,l=i.length,u;a<l;++a)u=i[a],u.vy+=(r[a]-u.y)*e[a]*o}function f(){if(i){var o,a=i.length;for(e=new Array(a),r=new Array(a),o=0;o<a;++o)e[o]=isNaN(r[o]=+t(i[o],o,i))?0:+n(i[o],o,i)}}return s.initialize=function(o){i=o,f()},s.strength=function(o){return arguments.length?(n=typeof o=="function"?o:q(+o),f(),s):n},s.y=function(o){return arguments.length?(t=typeof o=="function"?o:q(+o),f(),s):t},s}function ti(t){var n=q(.1),i,e,r;typeof t!="function"&&(t=q(t==null?0:+t));function s(o){for(var a=0,l=i.length,u;a<l;++a)u=i[a],u.vz+=(r[a]-u.z)*e[a]*o}function f(){if(i){var o,a=i.length;for(e=new Array(a),r=new Array(a),o=0;o<a;++o)e[o]=isNaN(r[o]=+t(i[o],o,i))?0:+n(i[o],o,i)}}return s.initialize=function(o){i=o,f()},s.strength=function(o){return arguments.length?(n=typeof o=="function"?o:q(+o),f(),s):n},s.z=function(o){return arguments.length?(t=typeof o=="function"?o:q(+o),f(),s):t},s}self.addEventListener("message",t=>{const{type:n,id:i,payload:e}=t.data;if(n==="CALCULATE_LAYOUT")try{const r=performance.now(),{nodes:s,edges:f,layoutType:o,dimensions:a=3,nodeStrength:l=-250,linkDistance:u=50}=e,c=s.map(h=>({...h}));c.forEach((h,d)=>{h.x===void 0&&(h.x=Math.random()*100-50),h.y===void 0&&(h.y=Math.random()*100-50),h.z===void 0&&(h.z=a===3?Math.random()*100-50:0)});const v=ni(o,c,f,a,l,u);let g=0;const _=300,z=setInterval(()=>{g<100&&self.postMessage({type:"LAYOUT_PROGRESS",id:i,payload:{progress:g,nodes:c}})},100);for(let h=0;h<_;h++)v.tick(),g=Math.round(h/_*100);clearInterval(z);const x=performance.now()-r;self.postMessage({type:"LAYOUT_COMPLETE",id:i,payload:{nodes:c,duration:x}})}catch(r){self.postMessage({type:"LAYOUT_ERROR",id:i,error:r instanceof Error?r.message:"Unknown error"})}});function ni(t,n,i,e,r,s){const f=Kn(n).force("center",jt(0,0,0)).force("charge",Vn().strength(r)).force("collide",On(o=>(o.radius||20)+10));return i.length>0&&f.force("link",Sn(i).id(o=>o.id).distance(s)),t==="forceDirected2d"||e===2?f.force("x",zt()).force("y",Nt()).force("z",null):f.force("x",zt(0).strength(.05)).force("y",Nt(0).strength(.05)).force("z",ti(0).strength(.05)),f.stop(),f}
